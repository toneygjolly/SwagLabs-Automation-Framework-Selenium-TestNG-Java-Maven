package swaglabproject_testing;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;

import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.edge.EdgeDriver;
import org.testng.Assert;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;
import org.testng.asserts.SoftAssert;

@Test
public class login_page {
	WebDriver driver;

	@BeforeMethod
	public void OpenBrowser() throws InterruptedException {
		// driver =new EdgeDriver();
		driver = new ChromeDriver();
		driver.manage().window().maximize();
		driver.get("https://www.saucedemo.com/");
		Thread.sleep(1000);
	}

	// TESTCASE ID:TC001
	@Test(priority = 1)
	public void correct_username_password() {
		String title = driver.getTitle();
		System.out.println("The title of web page :" + title);
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		Assert.assertTrue(driver.getCurrentUrl().contains("inventory.html"));

	}

	// TESTCASE ID:TC002
	@Test(priority = 2)
	public void incorrect_username_password() {
		SoftAssert softAssert = new SoftAssert();
		String title = driver.getTitle();
		System.out.println("The title of web page :" + title);
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user11");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce12");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		WebElement errorMsg = driver.findElement(By.cssSelector("h3[data-test='error']"));

		// Soft assertions
		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message NOT displayed");

		softAssert.assertTrue(driver.getCurrentUrl().contains("inventory.html"),
				"User should NOT be navigated to inventory page");

		softAssert.assertAll();

	}

	// TESTCASE ID:TC003
	@Test(priority = 3)
	public void not_enter_username_password() {
		SoftAssert softAssert = new SoftAssert();
		String title = driver.getTitle();
		System.out.println("The title of web page :" + title);
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		WebElement errorMsg = driver.findElement(By.cssSelector("h3[data-test='error']"));

		// Soft assertions
		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message NOT displayed");

		softAssert.assertTrue(driver.getCurrentUrl().contains("inventory.html"),
				"User should NOT be navigated to inventory page");

		softAssert.assertAll();

	}

	// TESTCASE ID:TC004
	@Test(priority = 4)
	public void valid_username_and_blank_password_column() {
		SoftAssert softAssert = new SoftAssert();
		String title = driver.getTitle();
		System.out.println("The title of web page :" + title);
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user11");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		WebElement errorMsg = driver.findElement(By.cssSelector("h3[data-test='error']"));

		// Soft assertions
		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message NOT displayed");

		softAssert.assertTrue(driver.getCurrentUrl().contains("inventory.html"),
				"User should NOT be navigated to inventory page");

		softAssert.assertAll();

	}

	// TESTCASE ID:TC005
	@Test(priority = 5)
	public void blank_username_column_and_valid_password() {
		SoftAssert softAssert = new SoftAssert();
		String title = driver.getTitle();
		System.out.println("The title of web page :" + title);
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce12");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		WebElement errorMsg = driver.findElement(By.cssSelector("h3[data-test='error']"));

		// Soft assertions
		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message NOT displayed");

		softAssert.assertTrue(driver.getCurrentUrl().contains("inventory.html"),
				"User should NOT be navigated to inventory page");

		softAssert.assertAll();

	}

	@AfterMethod
	public void aftercomplete(ITestResult result) {

		if (ITestResult.FAILURE == result.getStatus()) {
			try {
				TakesScreenshot ts = (TakesScreenshot) driver;
				File source = ts.getScreenshotAs(OutputType.FILE);

				File destination = new File(
						"C:/Users/toney/Pictures/TestNG_screenshot/login_page/" + result.getName() + ".png");

				Files.copy(source.toPath(), destination.toPath(), StandardCopyOption.REPLACE_EXISTING);

				System.out.println("Screenshot taken for failed test: " + result.getName());

			} catch (IOException e) {
				e.printStackTrace();
			}
		}

		driver.quit();
	}

}

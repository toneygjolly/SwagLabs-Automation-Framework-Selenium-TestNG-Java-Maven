package swaglabproject_testing;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;

import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

@Test
public class home_page {
	WebDriver driver;

	@BeforeMethod
	public void OpenBrowser() throws InterruptedException {

		driver = new ChromeDriver();
		driver.manage().window().maximize();
		driver.get("https://www.saucedemo.com/");
		Thread.sleep(1000);
	}

	// TESTCASE ID:TC006
	@Test(priority = 1, enabled = true)
	public void user_able_to_enter_homepage() throws InterruptedException {

		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		// Home page
		Thread.sleep(1000);
		WebElement firstimageclick = driver.findElement(By.className("inventory_item_img"));
		Thread.sleep(1000);
		firstimageclick.click();

	}

	// TESTCASE ID:TC007
	@Test(priority = 2, enabled = true)
	public void user_able_add_product_to_cart() throws InterruptedException {

		driver.findElement(By.id("user-name")).sendKeys("standard_user");
		driver.findElement(By.id("password")).sendKeys("secret_sauce");
		driver.findElement(By.id("login-button")).click();
		Thread.sleep(2000);

		driver.findElement(By.id("add-to-cart-sauce-labs-bike-light")).click();

		WebElement cartpage = driver.findElement(By.className("shopping_cart_link"));
		cartpage.click();

	}

	@AfterMethod
	public void aftercomplete(ITestResult result) {

		if (ITestResult.FAILURE == result.getStatus()) {
			try {
				TakesScreenshot ts = (TakesScreenshot) driver;
				File source = ts.getScreenshotAs(OutputType.FILE);

				File destination = new File(
						"C:/Users/toney/Pictures/TestNG_screenshot/home_page/" + result.getName() + ".png");

				Files.copy(source.toPath(), destination.toPath(), StandardCopyOption.REPLACE_EXISTING);

				System.out.println("Screenshot taken for failed test: " + result.getName());

			} catch (IOException e) {
				e.printStackTrace();
			}
		}

		driver.quit();
	}

}

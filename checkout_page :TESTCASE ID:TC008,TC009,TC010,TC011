package swaglabproject_testing;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.StandardCopyOption;
import java.time.Duration;

import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;
import org.testng.asserts.SoftAssert;

@Test
public class checkout_page {
	WebDriver driver;

	@BeforeMethod
	public void OpenBrowser() throws InterruptedException {

		driver = new ChromeDriver();
		driver.manage().window().maximize();
		driver.get("https://www.saucedemo.com/");
		Thread.sleep(1000);
	}

	// TESTCASE ID:TC008
	@Test(priority = 1, enabled = true)
	public void user_able_to_enter_userdetails_Checkout_Overview() throws InterruptedException {
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		// Home page
		driver.findElement(By.id("add-to-cart-sauce-labs-bike-light")).click();
		WebElement cartpage = driver.findElement(By.className("shopping_cart_link"));
		cartpage.click();
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
		WebElement checkoutbutton = driver.findElement(By.id("checkout"));
		checkoutbutton.click();
		// checkout Your Information page
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("first-name")));
		WebElement First_name = driver.findElement(By.id("first-name"));
		First_name.sendKeys("George");
		WebElement last_name = driver.findElement(By.id("last-name"));
		last_name.sendKeys("Jone");
		WebElement postal_code = driver.findElement(By.id("postal-code"));
		postal_code.sendKeys("670672");
		WebElement Continue_button = driver.findElement(By.id("continue"));
		Continue_button.click();
		// checkout overview page
		WebElement payment_information = driver.findElement(By.className("summary_value_label"));
		System.out.println("payment_information :" + payment_information.getText());
		WebElement itemtotal = driver.findElement(By.className("summary_subtotal_label"));
		System.out.println("itemtotal :" + itemtotal);
		WebElement Finishbutton = driver.findElement(By.className("cart_button"));
		Thread.sleep(2000);
		Finishbutton.click();
	}

	// TESTCASE ID:TC009
	@Test(priority = 1, enabled = true)
	public void checkout_Your_Information_page_not_enter_first_name() {
		SoftAssert softAssert = new SoftAssert();
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		// Home page
		driver.findElement(By.id("add-to-cart-sauce-labs-bike-light")).click();
		WebElement cartpage = driver.findElement(By.className("shopping_cart_link"));
		cartpage.click();
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
		WebElement checkoutbutton = driver.findElement(By.id("checkout"));
		checkoutbutton.click();
		// checkout Your Information page
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("first-name")));
		WebElement First_name = driver.findElement(By.id("first-name"));
		First_name.sendKeys("");
		WebElement last_name = driver.findElement(By.id("last-name"));
		last_name.sendKeys("Jone");
		WebElement postal_code = driver.findElement(By.id("postal-code"));
		postal_code.sendKeys("670672");
		WebElement Continue_button = driver.findElement(By.id("continue"));
		Continue_button.click();
		WebElement errorMsg = wait
				.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("h3[data-test='error']")));

		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message is not displayed for empty First Name");

		softAssert.assertEquals(errorMsg.getText(), "Error: First Name is required");

		softAssert.assertAll();
	}

	/*
	 * // checkout overview page WebElement payment_information =
	 * driver.findElement(By.className("summary_value_label"));
	 * System.out.println("payment_information :" + payment_information.getText());
	 * WebElement itemtotal =
	 * driver.findElement(By.className("summary_subtotal_label"));
	 * System.out.println("itemtotal :" + itemtotal); WebElement Finishbutton =
	 * driver.findElement(By.className("cart_button"));
	 * 
	 * Finishbutton.click(); }
	 */
	// TESTCASE ID:TC010
	@Test(priority = 1, enabled = true)
	public void checkout_Your_Information_page_not_enter_last_name() {
		SoftAssert softAssert = new SoftAssert();
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		// Home page
		driver.findElement(By.id("add-to-cart-sauce-labs-bike-light")).click();
		WebElement cartpage = driver.findElement(By.className("shopping_cart_link"));
		cartpage.click();
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
		WebElement checkoutbutton = driver.findElement(By.id("checkout"));
		checkoutbutton.click();
		// checkout Your Information page
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("first-name")));
		WebElement First_name = driver.findElement(By.id("first-name"));
		First_name.sendKeys("George");
		WebElement last_name = driver.findElement(By.id("last-name"));
		last_name.sendKeys("");
		WebElement postal_code = driver.findElement(By.id("postal-code"));
		postal_code.sendKeys("670672");
		WebElement Continue_button = driver.findElement(By.id("continue"));
		Continue_button.click();
		WebElement errorMsg = wait
				.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("h3[data-test='error']")));

		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message is not displayed for empty last Name");

		softAssert.assertEquals(errorMsg.getText(), "Error: last Name is required");

		softAssert.assertAll();
	}

	// TESTCASE ID:TC011
	@Test(priority = 1, enabled = true)
	public void checkout_Your_Information_page_not_enter_postal_code() {
		SoftAssert softAssert = new SoftAssert();
		WebElement username = driver.findElement(By.id("user-name"));
		username.sendKeys("standard_user");
		WebElement password = driver.findElement(By.id("password"));
		password.sendKeys("secret_sauce");
		WebElement login_button = driver.findElement(By.id("login-button"));
		login_button.click();
		// Home page
		driver.findElement(By.id("add-to-cart-sauce-labs-bike-light")).click();
		WebElement cartpage = driver.findElement(By.className("shopping_cart_link"));
		cartpage.click();
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
		WebElement checkoutbutton = driver.findElement(By.id("checkout"));
		checkoutbutton.click();
		// checkout Your Information page
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("first-name")));
		WebElement First_name = driver.findElement(By.id("first-name"));
		First_name.sendKeys("George");
		WebElement last_name = driver.findElement(By.id("last-name"));
		last_name.sendKeys("john");
		WebElement postal_code = driver.findElement(By.id("postal-code"));
		postal_code.sendKeys("");
		WebElement Continue_button = driver.findElement(By.id("continue"));
		Continue_button.click();
		WebElement errorMsg = wait
				.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("h3[data-test='error']")));

		softAssert.assertTrue(errorMsg.isDisplayed(), "Error message is not displayed for empty postal-code");

		softAssert.assertEquals(errorMsg.getText(), "Error: postal-code is required");

		softAssert.assertAll();
	}

	@AfterMethod
	public void aftercomplete(ITestResult result) {

		if (ITestResult.FAILURE == result.getStatus()) {
			try {
				TakesScreenshot ts = (TakesScreenshot) driver;
				File source = ts.getScreenshotAs(OutputType.FILE);

				File destination = new File(
						"C:/Users/toney/Pictures/TestNG_screenshot/checkout_page/" + result.getName() + ".png");

				Files.copy(source.toPath(), destination.toPath(), StandardCopyOption.REPLACE_EXISTING);

				System.out.println("Screenshot taken for failed test: " + result.getName());

			} catch (IOException e) {
				e.printStackTrace();
			}
		}

		driver.quit();
	}

}
